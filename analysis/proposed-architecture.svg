<?xml version="1.0" encoding="UTF-8"?>
<svg width="1000" height="700" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font-family: Arial, sans-serif; font-size: 20px; font-weight: bold; }
      .subtitle { font-family: Arial, sans-serif; font-size: 16px; font-weight: bold; }
      .component { font-family: Arial, sans-serif; font-size: 11px; }
      .small-text { font-family: Arial, sans-serif; font-size: 9px; }
      .benefit-text { font-family: Arial, sans-serif; font-size: 10px; fill: #006400; }
      .unchanged-text { font-family: Arial, sans-serif; font-size: 9px; fill: green; font-weight: bold; }
    </style>
  </defs>
  
  <!-- Title -->
  <text x="500" y="30" text-anchor="middle" class="title">Proposed Separated Architecture: Rust MITM + Java Audit</text>
  
  <!-- Rust MITM Process (Left) -->
  <rect x="50" y="80" width="350" height="280" rx="10" fill="#CE422B" fill-opacity="0.3" stroke="black" stroke-width="2"/>
  <text x="225" y="105" text-anchor="middle" class="subtitle" fill="white">Rust MITM Process</text>
  
  <!-- Rust Components -->
  <rect x="80" y="130" width="100" height="50" rx="3" fill="white" stroke="black"/>
  <text x="130" y="150" text-anchor="middle" class="component">SSH MITM</text>
  <text x="130" y="165" text-anchor="middle" class="small-text">(russh)</text>
  
  <rect x="200" y="130" width="100" height="50" rx="3" fill="white" stroke="black"/>
  <text x="250" y="150" text-anchor="middle" class="component">RDP MITM</text>
  <text x="250" y="165" text-anchor="middle" class="small-text">(IronRDP)</text>
  
  <rect x="320" y="130" width="100" height="50" rx="3" fill="white" stroke="black"/>
  <text x="370" y="150" text-anchor="middle" class="component">WebSocket</text>
  <text x="370" y="165" text-anchor="middle" class="small-text">Streaming</text>
  
  <rect x="80" y="200" width="120" height="50" rx="3" fill="white" stroke="black"/>
  <text x="140" y="220" text-anchor="middle" class="component">Credential Lookup</text>
  <text x="140" y="235" text-anchor="middle" class="small-text">via IPC</text>
  
  <rect x="220" y="200" width="120" height="50" rx="3" fill="white" stroke="black"/>
  <text x="280" y="220" text-anchor="middle" class="component">Protocol State</text>
  <text x="280" y="235" text-anchor="middle" class="small-text">Management</text>
  
  <!-- Java Audit Process (Right) -->
  <rect x="600" y="80" width="350" height="280" rx="10" fill="#FF6B35" fill-opacity="0.3" stroke="black" stroke-width="2"/>
  <text x="775" y="105" text-anchor="middle" class="subtitle">Java Audit Process</text>
  
  <!-- Java Components (UNCHANGED) -->
  <rect x="630" y="130" width="120" height="50" rx="3" fill="#4ECDC4" fill-opacity="0.8" stroke="black"/>
  <text x="690" y="150" text-anchor="middle" class="component">AuditFile.java</text>
  <text x="690" y="165" text-anchor="middle" class="unchanged-text">(UNCHANGED)</text>
  
  <rect x="770" y="130" width="140" height="50" rx="3" fill="#4ECDC4" fill-opacity="0.8" stroke="black"/>
  <text x="840" y="150" text-anchor="middle" class="component">DatabaseAuditWriter</text>
  <text x="840" y="165" text-anchor="middle" class="unchanged-text">(UNCHANGED)</text>
  
  <rect x="630" y="200" width="140" height="50" rx="3" fill="#4ECDC4" fill-opacity="0.8" stroke="black"/>
  <text x="700" y="220" text-anchor="middle" class="component">TerminalAuditWriter</text>
  <text x="700" y="235" text-anchor="middle" class="unchanged-text">(UNCHANGED)</text>
  
  <rect x="790" y="200" width="140" height="50" rx="3" fill="#4ECDC4" fill-opacity="0.8" stroke="black"/>
  <text x="860" y="220" text-anchor="middle" class="component">GuessingConnectionLinker</text>
  <text x="860" y="235" text-anchor="middle" class="unchanged-text">(UNCHANGED)</text>
  
  <rect x="710" y="270" width="160" height="50" rx="3" fill="#4ECDC4" fill-opacity="0.8" stroke="black"/>
  <text x="790" y="290" text-anchor="middle" class="component">CredentialInjectionService</text>
  <text x="790" y="305" text-anchor="middle" class="unchanged-text">(UNCHANGED)</text>
  
  <!-- IPC Interface (Center) -->
  <rect x="450" y="180" width="100" height="120" rx="5" fill="#96CEB4" fill-opacity="0.8" stroke="black" stroke-width="2"/>
  <text x="500" y="200" text-anchor="middle" class="subtitle">IPC Interface</text>
  
  <text x="500" y="220" text-anchor="middle" class="small-text">• Credential Lookup</text>
  <text x="500" y="235" text-anchor="middle" class="small-text">• Audit Events</text>
  <text x="500" y="250" text-anchor="middle" class="small-text">• Session Lifecycle</text>
  <text x="500" y="265" text-anchor="middle" class="small-text">• WebSocket Data</text>
  
  <!-- Bidirectional IPC arrows -->
  <defs>
    <marker id="greenarrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="green"/>
    </marker>
  </defs>
  
  <!-- Rust to IPC -->
  <line x1="400" y1="220" x2="450" y2="220" stroke="green" stroke-width="3" marker-end="url(#greenarrow)"/>
  <line x1="400" y1="260" x2="450" y2="260" stroke="green" stroke-width="3" marker-end="url(#greenarrow)"/>
  
  <!-- IPC to Java -->
  <line x1="550" y1="220" x2="600" y2="220" stroke="green" stroke-width="3" marker-end="url(#greenarrow)"/>
  <line x1="550" y1="260" x2="600" y2="260" stroke="green" stroke-width="3" marker-end="url(#greenarrow)"/>
  
  <!-- Java to IPC (responses) -->
  <line x1="600" y1="240" x2="550" y2="240" stroke="green" stroke-width="3" marker-end="url(#greenarrow)"/>
  <line x1="600" y1="280" x2="550" y2="280" stroke="green" stroke-width="3" marker-end="url(#greenarrow)"/>
  
  <!-- IPC to Rust (responses) -->
  <line x1="450" y1="240" x2="400" y2="240" stroke="green" stroke-width="3" marker-end="url(#greenarrow)"/>
  <line x1="450" y1="280" x2="400" y2="280" stroke="green" stroke-width="3" marker-end="url(#greenarrow)"/>
  
  <!-- Client connections -->
  <rect x="10" y="150" width="60" height="40" rx="5" fill="lightblue" stroke="black"/>
  <text x="40" y="165" text-anchor="middle" class="small-text">Native</text>
  <text x="40" y="180" text-anchor="middle" class="small-text">Clients</text>
  
  <rect x="10" y="220" width="60" height="40" rx="5" fill="#45B7D1" stroke="black"/>
  <text x="40" y="235" text-anchor="middle" class="small-text">Web</text>
  <text x="40" y="250" text-anchor="middle" class="small-text">Clients</text>
  
  <!-- Client arrows -->
  <defs>
    <marker id="bluearrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="blue"/>
    </marker>
    <marker id="webarrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#45B7D1"/>
    </marker>
  </defs>
  
  <line x1="70" y1="170" x2="80" y2="170" stroke="blue" stroke-width="2" marker-end="url(#bluearrow)"/>
  <line x1="70" y1="240" x2="80" y2="200" stroke="#45B7D1" stroke-width="2" marker-end="url(#webarrow)"/>
  
  <!-- External systems -->
  <rect x="720" y="380" width="60" height="30" rx="3" fill="lightgray" stroke="black"/>
  <text x="750" y="400" text-anchor="middle" class="small-text">Database</text>
  
  <rect x="820" y="380" width="60" height="30" rx="3" fill="lightgray" stroke="black"/>
  <text x="850" y="400" text-anchor="middle" class="small-text">Audit Files</text>
  
  <!-- External arrows -->
  <defs>
    <marker id="grayarrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="gray"/>
    </marker>
  </defs>
  
  <line x1="750" y1="360" x2="750" y2="380" stroke="gray" stroke-width="2" marker-end="url(#grayarrow)"/>
  <line x1="850" y1="360" x2="850" y2="380" stroke="gray" stroke-width="2" marker-end="url(#grayarrow)"/>
  
  <!-- Process boundary -->
  <line x1="500" y1="60" x2="500" y2="370" stroke="red" stroke-width="3" stroke-dasharray="10,5" opacity="0.7"/>
  <text x="500" y="50" text-anchor="middle" class="small-text" fill="red">Process Boundary</text>
  
  <!-- Benefits annotation -->
  <rect x="50" y="450" width="400" height="120" rx="5" fill="lightgreen" fill-opacity="0.7" stroke="black"/>
  <text x="60" y="470" class="benefit-text">Benefits of Separated Architecture:</text>
  <text x="60" y="485" class="benefit-text">• Loose coupling via IPC interface</text>
  <text x="60" y="500" class="benefit-text">• Independent failure domains</text>
  <text x="60" y="515" class="benefit-text">• Web client support built-in</text>
  <text x="60" y="530" class="benefit-text">• Rust memory safety and performance</text>
  <text x="60" y="545" class="benefit-text">• Preserved audit architecture (95% unchanged)</text>
  <text x="60" y="560" class="benefit-text">• Minimal risk to existing functionality</text>
  
  <!-- Technical details -->
  <rect x="500" y="450" width="450" height="120" rx="5" fill="lightyellow" fill-opacity="0.7" stroke="black"/>
  <text x="510" y="470" class="benefit-text">Technical Implementation:</text>
  <text x="510" y="485" class="benefit-text">• IPC: Unix Domain Sockets / Named Pipes</text>
  <text x="510" y="500" class="benefit-text">• Serialization: MessagePack (compact binary)</text>
  <text x="510" y="515" class="benefit-text">• Error Handling: Timeout + Retry + Fallback</text>
  <text x="510" y="530" class="benefit-text">• Performance: &lt;10ms IPC overhead</text>
  <text x="510" y="545" class="benefit-text">• Compatibility: 100% audit format preservation</text>
  <text x="510" y="560" class="benefit-text">• Only 3 Java classes require modification</text>
  
  <!-- IPC flow indicator -->
  <text x="500" y="170" text-anchor="middle" class="small-text" fill="green">↕ Bidirectional IPC</text>
</svg>
